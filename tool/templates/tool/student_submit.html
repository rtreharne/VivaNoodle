{% extends "tool/base.html" %}
{% block content %}

<h2 class="page-heading">{{ assignment.title }}</h2>

<!-- ========================================================= -->
<!--  Latest Submission (single polished card)                  -->
<!-- ========================================================= -->

{% if latest_submission %}
<div class="card">

    <h3>Your Latest Submission</h3>

    <p class="subtle">
        Submitted on {{ latest_submission.created_at|date:"Y-m-d H:i" }}
    </p>

    {% if latest_submission.comment %}
        <div class="extracted-preview">
            <p>{{ latest_submission.comment|truncatechars:200 }}</p>
        </div>
    {% endif %}

    {% if latest_submission.vivasession %}
        <a class="button primary" href="{% url 'viva_session' latest_submission.vivasession.id %}">
            Resume Viva
        </a>
    {% else %}
        <p>When you are ready, begin your viva examination.</p>
        <a class="button primary" href="{% url 'viva_start' latest_submission.id %}">
            Begin Viva
        </a>
    {% endif %}



</div>
{% else %}

<p>You haven't submitted anything yet.</p>

{% endif %}


<!-- ========================================================= -->
<!--   Submission Options                                       -->
<!-- ========================================================= -->

{% if assignment.allow_multiple_submissions or not latest_submission %}

<div class="card">
    <h3>Upload Your Work</h3>
    <p class="subtle">Accepted formats: PDF, DOCX, TXT</p>

    <form action="{% url 'submit_file' %}" method="POST"
          enctype="multipart/form-data" class="submission-form">
        {% csrf_token %}
        <input type="file" id="file" name="file"
               accept=".pdf,.docx,.txt" required>
        <button type="submit" class="button" style="margin-top: 15px;">
            Upload File
        </button>
    </form>
</div>

<div class="card">
    <h3>Or Paste Your Text</h3>

    <form action="{% url 'submit_text' %}" method="POST" class="submission-form">
        {% csrf_token %}
        <textarea id="text" name="text" rows="8" required></textarea>
        <button type="submit" class="button" style="margin-top: 15px;">
            Submit Text
        </button>
    </form>
</div>

{% else %}
<p class="locked-msg">
    This assignment allows only one submission, and you have already submitted your work.
</p>
{% endif %}



{% endblock %}
