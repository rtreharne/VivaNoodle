{% extends "tool/base.html" %}
{% block content %}

<h2>Edit Assignment Settings</h2>

<div class="card" style="padding: 30px;">

    <form method="POST" action="{% url 'assignment_edit_save' %}" class="settings-form">
        {% csrf_token %}

        <!-- TITLE (read-only) -->
        <div class="form-row">
            <label>Assignment Title</label>
            <input value="{{ assignment.title }}" disabled class="readonly">
            <div class="help">Title comes from Canvas and cannot be edited here.</div>
        </div>

        <!-- DESCRIPTION -->
        <div class="form-row">
            <label for="description">Description</label>
            <textarea id="description" name="description" rows="4">{{ assignment.description }}</textarea>
        </div>

        <!-- MULTIPLE SUBMISSIONS -->
        <div class="form-row">
            <label for="allow_multiple">Multiple Submissions</label>
            <div class="checkbox-wrapper">
                <input type="checkbox" id="allow_multiple" name="allow_multiple"
                       {% if assignment.allow_multiple_submissions %}checked{% endif %}>
                <span>Allow students to submit more than once</span>
            </div>
        </div>

        <!-- DURATION -->
        <div class="form-row">
            <label for="viva_duration_seconds">Viva Duration (seconds)</label>
            <input id="viva_duration_seconds" name="viva_duration_seconds" 
                   type="number" min="60" value="{{ assignment.viva_duration_seconds }}">
        </div>

        <!-- NEW SETTINGS: TRACKING -------------------------------------------------------- -->

        <h3 style="margin-top: 30px; margin-bottom: 10px;">Tracking Settings</h3>

        <!-- Keystroke Tracking -->
        <div class="form-row">
            <label for="keystroke_tracking">Keystroke Tracking</label>
            <div class="checkbox-wrapper">
                <input type="checkbox" id="keystroke_tracking" name="keystroke_tracking"
                       {% if assignment.keystroke_tracking|default:True %}checked{% endif %}>
                <span>Log all keypress activity during the viva</span>
            </div>
        </div>

        <!-- Event Tracking -->
        <div class="form-row">
            <label for="event_tracking">Event Tracking</label>
            <div class="checkbox-wrapper">
                <input type="checkbox" id="event_tracking" name="event_tracking"
                       {% if assignment.event_tracking|default:True %}checked{% endif %}>
                <span>Track paste, copy, cut, blur, and focus events</span>
            </div>
        </div>

        <!-- Arrhythmic Typing -->
        <div class="form-row">
            <label for="arrhythmic_typing">Arrhythmic Typing Detection</label>
            <div class="checkbox-wrapper">
                <input type="checkbox" id="arrhythmic_typing" name="arrhythmic_typing"
                       {% if assignment.arrhythmic_typing|default:True %}checked{% endif %}>
                <span>Detect suspicious typing patterns (e.g., rapid alternating speed)</span>
            </div>
            <div class="help">Used only for behavioural integrity analysis.</div>
        </div>

        <!-- VIVA INSTRUCTIONS -->
        <div class="form-row">
            <label for="viva_instructions">Viva Instructions</label>
            <textarea id="viva_instructions" name="viva_instructions" rows="6"
            placeholder="How should the AI conduct the viva? (tone, strictness, what to probe, what to avoid, discipline-specific norms)">{{ assignment.viva_instructions }}</textarea>
            <div class="help">These instructions directly influence how the AI questions the student.</div>
        </div>

        <!-- INSTRUCTOR NOTES -->
        <div class="form-row">
            <label for="instructor_notes">Instructor Notes</label>
            <textarea id="instructor_notes" name="instructor_notes" rows="4"
            placeholder="Private notes about the assignment or viva.">{{ assignment.instructor_notes }}</textarea>
        </div>

        <div class="form-actions">
            <button type="submit" class="button primary">Save Changes</button>
        </div>

    </form>

</div>

{% endblock %}
