databases:
  - name: machinaviva-db
    plan: basic-256mb
    databaseName: machinaviva
    user: machinaviva

services:
  - type: web
    name: machinaviva
    env: python
    buildCommand: "pip install -r requirements.txt && python manage.py collectstatic --noinput"
    startCommand: "gunicorn lti.wsgi:application"
    envVars:
      - key: DEBUG
        value: "false"
      - key: SECRET_KEY
        generateValue: true
      - key: SECURE_SSL_REDIRECT
        value: "true"
      - key: MEDIA_ROOT
        value: "/var/data/media"
      - key: DATABASE_URL
        fromDatabase:
          name: machinaviva-db
          property: connectionString
      - key: OPENAI_API_KEY
        sync: false
      - key: EMAIL_BACKEND
        value: "django.core.mail.backends.smtp.EmailBackend"
      - key: DEFAULT_FROM_EMAIL
        value: "MachinaViva <hello@machinaviva.co.uk>"
      - key: EMAIL_HOST
        value: "smtp-relay.brevo.com"
      - key: EMAIL_PORT
        value: "587"
      - key: EMAIL_HOST_USER
        value: "9a88b0001@smtp-brevo.com"
      - key: EMAIL_HOST
        sync: false
      - key: EMAIL_PORT
        sync: false
      - key: EMAIL_HOST_USER
        sync: false
      - key: EMAIL_HOST_PASSWORD
        sync: false
      - key: EMAIL_USE_TLS
        value: "true"
      - key: LTI_PRIVATE_KEY_PATH
        value: "/etc/secrets/lti_private.pem"
      - key: LTI_PUBLIC_KEY_PATH
        value: "/etc/secrets/lti_public.pem"
      - key: LTI_ISS
        sync: false
      - key: LTI_CLIENT_ID
        sync: false
      - key: LTI_DEPLOYMENT_ID
        sync: false
      - key: LTI_PLATFORM_JWKS_URL
        sync: false
      - key: LTI_PLATFORM_AUTHORIZE_URL
        sync: false
      - key: LTI_REDIRECT_URI
        sync: false
      - key: ALLOWED_HOSTS
        value: "machinaviva.co.uk,.machinaviva.co.uk"
      - key: CSRF_TRUSTED_ORIGINS
        value: "https://machinaviva.co.uk,https://*.machinaviva.co.uk"
    disk:
      name: media
      mountPath: /var/data
      sizeGB: 10
